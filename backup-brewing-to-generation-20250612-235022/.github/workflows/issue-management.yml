name: ğŸ¤– TD Issue Management

on:
  issues:
    types: [opened, edited, labeled]
  pull_request:
    types: [opened, edited, labeled]

jobs:
  welcome_new_contributor:
    if: github.event.action == 'opened'
    runs-on: ubuntu-latest
    steps:
      - name: Welcome New Issue
        if: github.event_name == 'issues'
        uses: actions/github-script@v6
        with:
          script: |
            const issue = context.payload.issue;
            const author = issue.user.login;

            const welcomeMessage = `
            ## ğŸ¤– TDã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

            @${author} ã•ã‚“ã€Issueã‚’ä½œæˆã—ã¦ã„ãŸã ãã€ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼

            TDãŒå†…å®¹ã‚’ç¢ºèªã—ã¦ã€é©åˆ‡ã«å¯¾å¿œã„ãŸã—ã¾ã™ã€‚

            ğŸ“‹ **æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—**:
            1. ãƒ©ãƒ™ãƒ«ã®è‡ªå‹•ä»˜ä¸
            2. å„ªå…ˆåº¦ã®è©•ä¾¡
            3. æ‹…å½“è€…ã®ã‚¢ã‚µã‚¤ãƒ³
            4. é€²æ—çŠ¶æ³ã®æ›´æ–°

            ğŸ•’ **å¯¾å¿œç›®å®‰**:
            - ğŸš¨ Critical: 24æ™‚é–“ä»¥å†…
            - ğŸ”´ High: 3æ—¥ä»¥å†…  
            - ğŸŸ¡ Medium: 1é€±é–“ä»¥å†…
            - ğŸŸ¢ Low: æ¬¡å›ãƒªãƒªãƒ¼ã‚¹æ™‚

            ä½•ã‹ã”è³ªå•ãŒã”ã–ã„ã¾ã—ãŸã‚‰ã€ãŠæ°—è»½ã«ãŠå£°ã‹ã‘ãã ã•ã„â™ª
            `;

            github.rest.issues.createComment({
              issue_number: issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: welcomeMessage
            });

      - name: Welcome New Pull Request
        if: github.event_name == 'pull_request'
        uses: actions/github-script@v6
        with:
          script: |
            const pr = context.payload.pull_request;
            const author = pr.user.login;

            const welcomeMessage = `
            ## ğŸ¤– TDã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

            @${author} ã•ã‚“ã€Pull Requestã‚’ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼

            ğŸ” **ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹**:
            1. è‡ªå‹•ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
            2. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯
            3. ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼
            4. çµ±åˆãƒ†ã‚¹ãƒˆ

            âœ… **ãƒãƒ¼ã‚¸æ¡ä»¶**:
            - [ ] CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æˆåŠŸ
            - [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯é€šé
            - [ ] 2åä»¥ä¸Šã®ãƒ¬ãƒ“ãƒ¥ãƒ¼æ‰¿èª
            - [ ] ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ç¶­æŒ

            TDãŒã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã®ã§ã€å®‰å¿ƒã—ã¦ãŠå¾…ã¡ãã ã•ã„â™ª
            `;

            github.rest.issues.createComment({
              issue_number: pr.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: welcomeMessage
            });

  auto_label_security:
    if: "contains(github.event.issue.title, 'security') || contains(github.event.issue.body, 'security') || contains(github.event.issue.title, 'ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£')"
    runs-on: ubuntu-latest
    steps:
      - name: Add Security Label
        uses: actions/github-script@v6
        with:
          script: |
            github.rest.issues.addLabels({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              labels: ['security', 'priority/high']
            });

  auto_label_bug:
    if: "contains(github.event.issue.title, '[BUG]') || contains(github.event.issue.title, 'ãƒã‚°')"
    runs-on: ubuntu-latest
    steps:
      - name: Add Bug Labels
        uses: actions/github-script@v6
        with:
          script: |
            github.rest.issues.addLabels({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              labels: ['bug', 'needs-triage']
            });

  auto_label_feature:
    if: "contains(github.event.issue.title, '[FEATURE]') || contains(github.event.issue.title, 'æ©Ÿèƒ½è¦æœ›')"
    runs-on: ubuntu-latest
    steps:
      - name: Add Feature Labels
        uses: actions/github-script@v6
        with:
          script: |
            github.rest.issues.addLabels({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              labels: ['enhancement', 'feature-request']
            });

  stale_issue_management:
    runs-on: ubuntu-latest
    if: github.event_name == 'schedule'
    steps:
      - name: Close Stale Issues
        uses: actions/stale@v8
        with:
          repo-token: ${{ secrets.GITHUB_TOKEN }}
          stale-issue-message: |
            ## ğŸ¤– TDã‹ã‚‰ã®ãŠçŸ¥ã‚‰ã›

            ã“ã®Issueã¯30æ—¥é–“æ´»å‹•ãŒãªã„ãŸã‚ã€è‡ªå‹•çš„ã«å¤ã„Issueã¨ã—ã¦ãƒãƒ¼ã‚¯ã•ã‚Œã¾ã—ãŸã€‚

            ğŸ“‹ **æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**:
            - 7æ—¥ä»¥å†…ã«è¿”ä¿¡ã„ãŸã ã‘ã‚Œã°ã€ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã«æˆ»ã‚Šã¾ã™
            - è¿”ä¿¡ãŒãªã„å ´åˆã¯ã€è‡ªå‹•çš„ã«ã‚¯ãƒ­ãƒ¼ã‚ºã•ã‚Œã¾ã™

            å¼•ãç¶šãã‚µãƒãƒ¼ãƒˆãŒå¿…è¦ã§ã—ãŸã‚‰ã€ãŠæ°—è»½ã«ã‚³ãƒ¡ãƒ³ãƒˆã—ã¦ãã ã•ã„â™ª
          stale-pr-message: |
            ## ğŸ¤– TDã‹ã‚‰ã®ãŠçŸ¥ã‚‰ã›

            ã“ã®Pull Requestã¯30æ—¥é–“æ´»å‹•ãŒãªã„ãŸã‚ã€è‡ªå‹•çš„ã«å¤ã„PRã¨ã—ã¦ãƒãƒ¼ã‚¯ã•ã‚Œã¾ã—ãŸã€‚

            ğŸ“‹ **æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**:
            - 7æ—¥ä»¥å†…ã«æ›´æ–°ã„ãŸã ã‘ã‚Œã°ã€ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã«æˆ»ã‚Šã¾ã™
            - æ›´æ–°ãŒãªã„å ´åˆã¯ã€è‡ªå‹•çš„ã«ã‚¯ãƒ­ãƒ¼ã‚ºã•ã‚Œã¾ã™

            ãƒãƒ¼ã‚¸ã‚’ã”å¸Œæœ›ã®å ´åˆã¯ã€ãƒªãƒ™ãƒ¼ã‚¹ã¾ãŸã¯æ›´æ–°ã‚’ãŠé¡˜ã„ã—ã¾ã™â™ª
          close-issue-message: |
            ## ğŸ¤– TDã‹ã‚‰ã®ãŠçŸ¥ã‚‰ã›

            ã“ã®Issueã¯æ´»å‹•ãŒãªã„ãŸã‚è‡ªå‹•çš„ã«ã‚¯ãƒ­ãƒ¼ã‚ºã•ã‚Œã¾ã—ãŸã€‚

            å•é¡ŒãŒè§£æ±ºã—ã¦ã„ãªã„å ´åˆã¯ã€æ–°ã—ã„Issueã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚
            ã„ã¤ã§ã‚‚TDãŒã‚µãƒãƒ¼ãƒˆã—ã¾ã™â™ª
          close-pr-message: |
            ## ğŸ¤– TDã‹ã‚‰ã®ãŠçŸ¥ã‚‰ã›

            ã“ã®Pull Requestã¯æ´»å‹•ãŒãªã„ãŸã‚è‡ªå‹•çš„ã«ã‚¯ãƒ­ãƒ¼ã‚ºã•ã‚Œã¾ã—ãŸã€‚

            å¤‰æ›´ã‚’ãƒãƒ¼ã‚¸ã—ãŸã„å ´åˆã¯ã€æ–°ã—ã„PRã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚
            TDãŒãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™â™ª
          stale-issue-label: "stale"
          stale-pr-label: "stale"
          days-before-stale: 30
          days-before-close: 7
