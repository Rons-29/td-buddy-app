# ğŸ› ï¸ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ§‹æˆãƒ—ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½ å®Ÿè£…ã‚¬ã‚¤ãƒ‰

**ğŸ¤– TDã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼š**
*ã€Œå®Ÿè£…ã®æ‰‹é †ã‚’è©³ã—ãã¾ã¨ã‚ã¾ã—ãŸï¼ã“ã®ã‚¬ã‚¤ãƒ‰ã«å¾“ã£ã¦é€²ã‚ã‚Œã°ã€è¿·ã‚ãšã«æ©Ÿèƒ½ã‚’å®Œæˆã•ã›ã‚‰ã‚Œã¾ã™ã‚ˆâ™ªã€*

---

## ğŸ¯ å®Ÿè£…æ¦‚è¦

### å®Ÿè£…ç¯„å›²
ç¾åœ¨ã®åŸºæœ¬ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç”Ÿæˆæ©Ÿèƒ½ã‚’æ‹¡å¼µã—ã€ä»¥ä¸‹ã®æ©Ÿèƒ½ã‚’è¿½åŠ ã—ã¾ã™ï¼š

1. **æ§‹æˆãƒ—ãƒªã‚»ãƒƒãƒˆé¸æŠæ©Ÿèƒ½**
2. **ã€Œå¿…ãšå«ã‚€ã€æ–‡å­—ç¨®æŒ‡å®šæ©Ÿèƒ½**
3. **ã‚«ã‚¹ã‚¿ãƒ è¨˜å·å…¥åŠ›æ©Ÿèƒ½**
4. **ã‚«ã‚¹ã‚¿ãƒ æ–‡å­—ç¨®è¨­å®šæ©Ÿèƒ½**
5. **å€‹æ•°è¨­å®šï¼ˆ50å€‹å¯¾å¿œï¼‰**

### æ¨å®šä½œæ¥­æ™‚é–“
**åˆè¨ˆï¼šç´„3æ™‚é–“**
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰æ”¹ä¿®ï¼š1æ™‚é–“30åˆ†
- ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰æ”¹ä¿®ï¼š1æ™‚é–“
- ãƒ†ã‚¹ãƒˆãƒ»å‹•ä½œç¢ºèªï¼š30åˆ†

---

## ğŸ“‹ å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### Phase 1: å‹å®šç¾©ãƒ»è¨­è¨ˆæº–å‚™ï¼ˆ15åˆ†ï¼‰
- [ ] æ–°ã—ã„å‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ
- [ ] æ—¢å­˜å‹å®šç¾©ã®æ‹¡å¼µ
- [ ] ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹è¨­è¨ˆã®ç¢ºèª

### Phase 2: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…ï¼ˆ1æ™‚é–“ï¼‰
- [ ] æ§‹æˆãƒ—ãƒªã‚»ãƒƒãƒˆå®šç¾©ã®å®Ÿè£…
- [ ] æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç”Ÿæˆã‚µãƒ¼ãƒ“ã‚¹ã®ä½œæˆ
- [ ] API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®è¿½åŠ 
- [ ] ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã®å®Ÿè£…
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®è¿½åŠ 

### Phase 3: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…ï¼ˆ1æ™‚é–“30åˆ†ï¼‰
- [ ] æ§‹æˆé¸æŠã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä½œæˆ
- [ ] ã‚«ã‚¹ã‚¿ãƒ è¨˜å·å…¥åŠ›ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä½œæˆ
- [ ] ã‚«ã‚¹ã‚¿ãƒ æ–‡å­—ç¨®è¨­å®šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä½œæˆ
- [ ] æ—¢å­˜PasswordGeneratorã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®æ‹¡å¼µ
- [ ] å€‹æ•°è¨­å®šã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤å¤‰æ›´

### Phase 4: çµ±åˆãƒ»ãƒ†ã‚¹ãƒˆï¼ˆ30åˆ†ï¼‰
- [ ] ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ»ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰çµ±åˆ
- [ ] å„ãƒ—ãƒªã‚»ãƒƒãƒˆã®å‹•ä½œç¢ºèª
- [ ] ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ã®ç¢ºèª
- [ ] TDã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®åå¿œç¢ºèª

---

## ğŸ”§ è©³ç´°å®Ÿè£…æ‰‹é †

### Phase 1: å‹å®šç¾©ãƒ»è¨­è¨ˆæº–å‚™

#### 1.1 å…±é€šå‹å®šç¾©ã®ä½œæˆ
```bash
# æ–°ã—ã„å‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
touch td-buddy-webapp/frontend/types/password-composition.ts
```

**`types/password-composition.ts`**
```typescript
// æ§‹æˆãƒ—ãƒªã‚»ãƒƒãƒˆå®šç¾©
export interface CompositionDefinition {
  id: string;
  label: string;
  description: string;
  type?: 'preset' | 'custom-symbols' | 'custom-charsets';
  requirements?: CompositionRequirement[];
}

// æ§‹æˆè¦ä»¶å®šç¾©
export interface CompositionRequirement {
  name: string;
  charset: string;
  min: number;
}

// ã‚«ã‚¹ã‚¿ãƒ æ–‡å­—ç¨®è¦ä»¶
export interface CustomCharsetRequirement {
  id: string;
  name: string;
  charset: string;
  min: number;
  enabled: boolean;
}

// æ‹¡å¼µã•ã‚ŒãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ¡ä»¶
export interface PasswordCriteriaExtended {
  // åŸºæœ¬è¨­å®š
  length: number;
  count: number;
  
  // æ§‹æˆãƒ—ãƒªã‚»ãƒƒãƒˆ
  composition: string;
  
  // åŸºæœ¬æ–‡å­—ç¨®ï¼ˆcomposition='none'æ™‚ï¼‰
  useNumbers: boolean;
  useUppercase: boolean;
  useLowercase: boolean;
  useSymbols: boolean;
  
  // ã‚«ã‚¹ã‚¿ãƒ è¨­å®š
  customSymbols?: string;
  customCharsets?: CustomCharsetRequirement[];
  
  // é™¤å¤–ã‚ªãƒ—ã‚·ãƒ§ãƒ³
  excludeSimilar: boolean;
  excludeAmbiguous: boolean;
}

// ç”Ÿæˆçµæœ
export interface CompositionPasswordResult {
  passwords: string[];
  strength: 'weak' | 'medium' | 'strong' | 'very-strong';
  estimatedCrackTime: string;
  criteria: PasswordCriteriaExtended;
  generatedAt: string;
  composition: {
    usedPreset: string;
    appliedRequirements: RequirementSummary[];
  };
}

// è¦ä»¶ã‚µãƒãƒªãƒ¼
export interface RequirementSummary {
  name: string;
  charset: string;
  requiredCount: number;
  actualCount: number;
  satisfied: boolean;
}
```

---

### Phase 2: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…

#### 2.1 æ§‹æˆãƒ—ãƒªã‚»ãƒƒãƒˆå®šç¾©ã‚µãƒ¼ãƒ“ã‚¹ã®ä½œæˆ
```bash
# æ–°ã—ã„ã‚µãƒ¼ãƒ“ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
touch td-buddy-webapp/backend/src/services/CompositionPasswordService.ts
```

**`services/CompositionPasswordService.ts`**
```typescript
import crypto from 'crypto';

interface Requirement {
  name: string;
  charset: string;
  min: number;
}

interface PasswordCriteriaExtended {
  length: number;
  count: number;
  composition: string;
  customSymbols?: string;
  customCharsets?: Array<{
    id: string;
    name: string;
    charset: string;
    min: number;
    enabled: boolean;
  }>;
  excludeSimilar?: boolean;
  excludeAmbiguous?: boolean;
}

export class CompositionPasswordService {
  // ãƒ—ãƒªã‚»ãƒƒãƒˆå®šç¾©
  private readonly defaultCompositions: Record<string, Requirement[] | null> = {
    'none': null,
    'num-upper-lower': [
      { name: 'numbers', charset: '0123456789', min: 1 },
      { name: 'uppercase', charset: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ', min: 1 },
      { name: 'lowercase', charset: 'abcdefghijklmnopqrstuvwxyz', min: 1 }
    ],
    'num-upper-lower-symbol': [
      { name: 'numbers', charset: '0123456789', min: 1 },
      { name: 'uppercase', charset: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ', min: 1 },
      { name: 'lowercase', charset: 'abcdefghijklmnopqrstuvwxyz', min: 1 },
      { name: 'symbols', charset: '!@#$%^&*()', min: 1 }
    ]
  };

  // ãƒ¡ã‚¤ãƒ³ç”Ÿæˆãƒ¡ã‚½ãƒƒãƒ‰
  generatePasswords(criteria: PasswordCriteriaExtended): string[] {
    this.validateCriteria(criteria);
    
    const passwords: string[] = [];
    
    for (let i = 0; i < criteria.count; i++) {
      const password = this.generateSinglePassword(criteria);
      passwords.push(password);
    }
    
    return passwords;
  }

  // å˜ä¸€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç”Ÿæˆ
  private generateSinglePassword(criteria: PasswordCriteriaExtended): string {
    const requirements = this.getRequirements(criteria);
    
    if (!requirements || requirements.length === 0) {
      return this.generateRandomPassword(criteria);
    }
    
    return this.generateWithRequirements(criteria, requirements);
  }

  // è¦ä»¶å–å¾—
  private getRequirements(criteria: PasswordCriteriaExtended): Requirement[] | null {
    // ãƒ—ãƒªã‚»ãƒƒãƒˆæ§‹æˆ
    if (this.defaultCompositions[criteria.composition]) {
      return this.defaultCompositions[criteria.composition];
    }
    
    // ã‚«ã‚¹ã‚¿ãƒ è¨˜å·
    if (criteria.composition === 'custom-symbols' && criteria.customSymbols) {
      return [
        { name: 'numbers', charset: '0123456789', min: 1 },
        { name: 'uppercase', charset: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ', min: 1 },
        { name: 'lowercase', charset: 'abcdefghijklmnopqrstuvwxyz', min: 1 },
        { name: 'customSymbols', charset: criteria.customSymbols, min: 1 }
      ];
    }
    
    // ã‚«ã‚¹ã‚¿ãƒ æ–‡å­—ç¨®
    if (criteria.composition === 'custom-charsets' && criteria.customCharsets) {
      return criteria.customCharsets
        .filter(cs => cs.enabled && cs.charset)
        .map(cs => ({
          name: cs.name,
          charset: cs.charset,
          min: cs.min
        }));
    }
    
    return null;
  }

  // è¦ä»¶ã‚’æº€ãŸã™ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç”Ÿæˆ
  private generateWithRequirements(
    criteria: PasswordCriteriaExtended, 
    requirements: Requirement[]
  ): string {
    let password = '';
    let remainingLength = criteria.length;
    
    // å¿…è¦æ–‡å­—æ•°ãƒã‚§ãƒƒã‚¯
    const totalRequired = requirements.reduce((sum, req) => sum + req.min, 0);
    if (totalRequired > criteria.length) {
      throw new Error('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰é•·ãŒå¿…è¦æ–‡å­—æ•°ã‚ˆã‚ŠçŸ­ã™ãã¾ã™');
    }
    
    // Step 1: å¿…é ˆæ–‡å­—ç¨®ã‹ã‚‰é…ç½®
    for (const req of requirements) {
      for (let i = 0; i < req.min; i++) {
        const char = this.getSecureRandomChar(req.charset);
        password += char;
        remainingLength--;
      }
    }
    
    // Step 2: æ®‹ã‚Šã‚’ãƒ©ãƒ³ãƒ€ãƒ ç”Ÿæˆ
    if (remainingLength > 0) {
      const allChars = this.buildAllowedCharset(criteria, requirements);
      for (let i = 0; i < remainingLength; i++) {
        const char = this.getSecureRandomChar(allChars);
        password += char;
      }
    }
    
    // Step 3: ã‚·ãƒ£ãƒƒãƒ•ãƒ«
    return this.shuffleString(password);
  }

  // é€šå¸¸ã®ãƒ©ãƒ³ãƒ€ãƒ ç”Ÿæˆï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
  private generateRandomPassword(criteria: PasswordCriteriaExtended): string {
    // æ—¢å­˜ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’ä½¿ç”¨
    let charset = '';
    if (criteria.useNumbers) charset += '0123456789';
    if (criteria.useUppercase) charset += 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
    if (criteria.useLowercase) charset += 'abcdefghijklmnopqrstuvwxyz';
    if (criteria.useSymbols) charset += '!@#$%^&*()';
    
    if (!charset) {
      throw new Error('æ–‡å­—ç¨®ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“');
    }
    
    let password = '';
    for (let i = 0; i < criteria.length; i++) {
      password += this.getSecureRandomChar(charset);
    }
    
    return password;
  }

  // ã‚»ã‚­ãƒ¥ã‚¢ãªæ–‡å­—é¸æŠ
  private getSecureRandomChar(charset: string): string {
    const randomIndex = crypto.randomInt(0, charset.length);
    return charset[randomIndex];
  }

  // æ–‡å­—åˆ—ã‚·ãƒ£ãƒƒãƒ•ãƒ«
  private shuffleString(str: string): string {
    const arr = str.split('');
    for (let i = arr.length - 1; i > 0; i--) {
      const j = crypto.randomInt(0, i + 1);
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr.join('');
  }

  // è¨±å¯æ–‡å­—ã‚»ãƒƒãƒˆæ§‹ç¯‰
  private buildAllowedCharset(
    criteria: PasswordCriteriaExtended,
    requirements: Requirement[]
  ): string {
    let charset = '';
    
    // è¦ä»¶ã‹ã‚‰æ–‡å­—ã‚»ãƒƒãƒˆæ§‹ç¯‰
    for (const req of requirements) {
      charset += req.charset;
    }
    
    // é™¤å¤–ã‚ªãƒ—ã‚·ãƒ§ãƒ³é©ç”¨
    if (criteria.excludeSimilar) {
      const similarChars = '0O1lI2Z5S6G8B';
      charset = charset.split('').filter(c => !similarChars.includes(c)).join('');
    }
    
    // é‡è¤‡é™¤å»
    return [...new Set(charset.split(''))].join('');
  }

  // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
  private validateCriteria(criteria: PasswordCriteriaExtended): void {
    if (criteria.length < 1 || criteria.length > 128) {
      throw new Error('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰é•·ã¯1-128æ–‡å­—ã®ç¯„å›²ã§è¨­å®šã—ã¦ãã ã•ã„');
    }
    
    if (criteria.count < 1 || criteria.count > 1000) {
      throw new Error('ç”Ÿæˆå€‹æ•°ã¯1-1000å€‹ã®ç¯„å›²ã§è¨­å®šã—ã¦ãã ã•ã„');
    }
    
    // ã‚«ã‚¹ã‚¿ãƒ è¨­å®šãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    if (criteria.composition === 'custom-charsets' && criteria.customCharsets) {
      for (const cs of criteria.customCharsets) {
        if (cs.enabled && !cs.charset) {
          throw new Error(`æ–‡å­—ç¨®ã€Œ${cs.name}ã€ã®æ–‡å­—ã‚»ãƒƒãƒˆãŒç©ºã§ã™`);
        }
      }
    }
  }
}
```

#### 2.2 æ–°ã—ã„APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®è¿½åŠ 
```bash
# æ—¢å­˜ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ«ãƒ¼ãƒˆã‚’æ‹¡å¼µ
# td-buddy-webapp/backend/src/routes/password.ts ã‚’ç·¨é›†
```

**`routes/password.ts` ã¸ã®è¿½åŠ **
```typescript
import { CompositionPasswordService } from '../services/CompositionPasswordService';

const compositionService = new CompositionPasswordService();

// æ–°ã—ã„ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’è¿½åŠ 
router.post('/generate-with-composition', async (req, res) => {
  try {
    const criteria = req.body;
    
    // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç”Ÿæˆ
    const passwords = compositionService.generatePasswords(criteria);
    
    // å¼·åº¦åˆ†æï¼ˆæ—¢å­˜ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’ä½¿ç”¨ï¼‰
    const samplePassword = passwords[0];
    const strength = analyzePasswordStrength(samplePassword);
    
    // TDãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆ
    const tdMessage = generateCompositionTDMessage(criteria, passwords.length, strength);
    
    const response = {
      success: true,
      data: {
        passwords,
        strength: strength.level,
        estimatedCrackTime: strength.crackTime,
        criteria,
        generatedAt: new Date().toISOString(),
        composition: {
          usedPreset: criteria.composition,
          appliedRequirements: [] // TODO: å®Ÿè£…
        }
      },
      tdMessage,
      timestamp: new Date().toISOString(),
      requestId: `pwd-comp-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`
    };
    
    res.json(response);
    
  } catch (error) {
    res.status(400).json({
      success: false,
      error: {
        message: error.message,
        code: 'COMPOSITION_GENERATION_ERROR'
      },
      tdMessage: 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç”Ÿæˆã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚'
    });
  }
});

// TDãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆé–¢æ•°
function generateCompositionTDMessage(criteria: any, count: number, strength: any): string {
  const messages = [
    `${criteria.composition}æ§‹æˆã§${count}å€‹ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¾ã—ãŸï¼`,
    `å¼·åº¦${strength.level}ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒã§ãã‚ãŒã‚Šã¾ã—ãŸâ™ª`,
    `å¿…è¦ãªæ–‡å­—ç¨®ãŒã™ã¹ã¦å«ã¾ã‚Œã¦ã„ã‚‹ã®ã§å®‰å¿ƒã§ã™ã­ï¼`,
    `å®Ÿç”¨çš„ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒå®Œæˆã§ã™ã€‚ãŠç–²ã‚Œã•ã¾ã§ã—ãŸâœ¨`
  ];
  
  return messages[Math.floor(Math.random() * messages.length)];
}
```

---

### Phase 3: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…

#### 3.1 æ§‹æˆé¸æŠã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä½œæˆ
```bash
# æ–°ã—ã„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
touch td-buddy-webapp/frontend/components/CompositionSelector.tsx
```

**`components/CompositionSelector.tsx`**
```typescript
'use client';

import React from 'react';

interface CompositionDefinition {
  id: string;
  label: string;
  description: string;
}

interface CompositionSelectorProps {
  value: string;
  onChange: (composition: string) => void;
}

export const CompositionSelector: React.FC<CompositionSelectorProps> = ({
  value,
  onChange
}) => {
  const compositions: CompositionDefinition[] = [
    {
      id: 'none',
      label: 'æŒ‡å®šãªã—',
      description: 'é¸æŠã•ã‚ŒãŸæ–‡å­—ç¨®ã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ç”Ÿæˆ'
    },
    {
      id: 'num-upper-lower',
      label: 'æ•°å­—ãƒ»å¤§æ–‡å­—ãƒ»å°æ–‡å­—ã‚’å¿…ãšå«ã‚€',
      description: '0-9ã€A-Zã€a-z ã‹ã‚‰å„1æ–‡å­—ä»¥ä¸Š'
    },
    {
      id: 'num-upper-lower-symbol',
      label: 'æ•°å­—ãƒ»å¤§æ–‡å­—ãƒ»å°æ–‡å­—ãƒ»è¨˜å·æ–‡å­—ã‚’å¿…ãšå«ã‚€',
      description: '0-9ã€A-Zã€a-zã€è¨˜å· ã‹ã‚‰å„1æ–‡å­—ä»¥ä¸Š'
    },
    {
      id: 'custom-symbols',
      label: 'æ•°å­—ãƒ»å¤§æ–‡å­—ãƒ»å°æ–‡å­—ãƒ»ã‚«ã‚¹ã‚¿ãƒ è¨˜å·ã‚’å¿…ãšå«ã‚€',
      description: 'è¨˜å·ã‚’è‡ªç”±ã«æŒ‡å®š'
    },
    {
      id: 'custom-charsets',
      label: 'ã‚«ã‚¹ã‚¿ãƒ æ–‡å­—ç¨®ã‚’å¿…ãšå«ã‚€',
      description: 'æ–‡å­—ç¨®ã‚’è‡ªç”±ã«æŒ‡å®š'
    }
  ];

  return (
    <div className="mb-6">
      <label className="block text-sm font-medium text-gray-700 mb-2">
        æ§‹æˆãƒ—ãƒªã‚»ãƒƒãƒˆ
      </label>
      <select 
        value={value} 
        onChange={(e) => onChange(e.target.value)}
        className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
      >
        {compositions.map(comp => (
          <option key={comp.id} value={comp.id}>
            {comp.label}
          </option>
        ))}
      </select>
      
      {value !== 'none' && (
        <p className="text-sm text-gray-600 mt-2">
          {compositions.find(c => c.id === value)?.description}
        </p>
      )}
    </div>
  );
};
```

#### 3.2 ã‚«ã‚¹ã‚¿ãƒ è¨˜å·å…¥åŠ›ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä½œæˆ
```bash
touch td-buddy-webapp/frontend/components/CustomSymbolsInput.tsx
```

**`components/CustomSymbolsInput.tsx`**
```typescript
'use client';

import React from 'react';

interface CustomSymbolsInputProps {
  value: string;
  onChange: (symbols: string) => void;
  visible: boolean;
}

export const CustomSymbolsInput: React.FC<CustomSymbolsInputProps> = ({
  value,
  onChange,
  visible
}) => {
  if (!visible) return null;

  return (
    <div className="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
      <label className="block text-sm font-medium text-gray-700 mb-2">
        ä½¿ç”¨ã™ã‚‹è¨˜å·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„
      </label>
      <input
        type="text"
        value={value}
        onChange={(e) => onChange(e.target.value)}
        placeholder="ä¾‹: $@_#&?"
        className="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500"
      />
      <div className="mt-2 space-y-1">
        <p className="text-xs text-gray-600">
          â€¢ å…¥åŠ›ã•ã‚ŒãŸè¨˜å·ã‹ã‚‰æœ€ä½1æ–‡å­—ã¯å¿…ãšå«ã¾ã‚Œã¾ã™
        </p>
        <p className="text-xs text-gray-600">
          â€¢ æ¨å¥¨è¨˜å·: $@_#&? (å…¥åŠ›ã—ã‚„ã™ã„è¨˜å·)
        </p>
      </div>
    </div>
  );
};
```

#### 3.3 ã‚«ã‚¹ã‚¿ãƒ æ–‡å­—ç¨®è¨­å®šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä½œæˆ
```bash
touch td-buddy-webapp/frontend/components/CustomCharsetsEditor.tsx
```

**`components/CustomCharsetsEditor.tsx`**
```typescript
'use client';

import React from 'react';

interface CustomCharsetRequirement {
  id: string;
  name: string;
  charset: string;
  min: number;
  enabled: boolean;
}

interface CustomCharsetsEditorProps {
  charsets: CustomCharsetRequirement[];
  onChange: (charsets: CustomCharsetRequirement[]) => void;
  visible: boolean;
}

export const CustomCharsetsEditor: React.FC<CustomCharsetsEditorProps> = ({
  charsets,
  onChange,
  visible
}) => {
  if (!visible) return null;

  const addCharset = () => {
    onChange([
      ...charsets,
      {
        id: `charset-${Date.now()}`,
        name: '',
        charset: '',
        min: 1,
        enabled: true
      }
    ]);
  };

  const removeCharset = (id: string) => {
    onChange(charsets.filter(cs => cs.id !== id));
  };

  const updateCharset = (id: string, field: keyof CustomCharsetRequirement, value: any) => {
    onChange(charsets.map(cs => 
      cs.id === id ? { ...cs, [field]: value } : cs
    ));
  };

  return (
    <div className="mt-4 p-4 bg-green-50 border border-green-200 rounded-lg">
      <h4 className="font-medium text-gray-700 mb-3">ã‚«ã‚¹ã‚¿ãƒ æ–‡å­—ç¨®è¨­å®š</h4>
      
      {charsets.map(charset => (
        <div key={charset.id} className="flex gap-2 mb-3 p-3 bg-white rounded border">
          <input
            type="text"
            placeholder="æ–‡å­—ç¨®åï¼ˆä¾‹: æ¯éŸ³ï¼‰"
            value={charset.name}
            onChange={(e) => updateCharset(charset.id, 'name', e.target.value)}
            className="flex-1 p-2 border border-gray-300 rounded"
          />
          <input
            type="text"
            placeholder="æ–‡å­—ã‚»ãƒƒãƒˆï¼ˆä¾‹: aeiouï¼‰"
            value={charset.charset}
            onChange={(e) => updateCharset(charset.id, 'charset', e.target.value)}
            className="flex-2 p-2 border border-gray-300 rounded"
          />
          <input
            type="number"
            min="1"
            value={charset.min}
            onChange={(e) => updateCharset(charset.id, 'min', parseInt(e.target.value))}
            className="w-16 p-2 border border-gray-300 rounded"
          />
          <button
            onClick={() => removeCharset(charset.id)}
            className="px-3 py-2 bg-red-500 text-white rounded hover:bg-red-600"
          >
            å‰Šé™¤
          </button>
        </div>
      ))}
      
      <button
        onClick={addCharset}
        className="w-full mt-2 px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600"
      >
        æ–‡å­—ç¨®ã‚’è¿½åŠ 
      </button>
    </div>
  );
};
```

#### 3.4 PasswordGeneratorã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®æ‹¡å¼µ
```bash
# æ—¢å­˜ã®PasswordGeneratorã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ç·¨é›†
# td-buddy-webapp/frontend/components/PasswordGenerator.tsx
```

**PasswordGenerator.tsxã¸ã®è¿½åŠ ãƒ»ä¿®æ­£ç®‡æ‰€**

```typescript
// ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚’è¿½åŠ 
import { CompositionSelector } from './CompositionSelector';
import { CustomSymbolsInput } from './CustomSymbolsInput';
import { CustomCharsetsEditor } from './CustomCharsetsEditor';

// å‹å®šç¾©ã‚’è¿½åŠ 
interface CustomCharsetRequirement {
  id: string;
  name: string;
  charset: string;
  min: number;
  enabled: boolean;
}

// stateã®è¿½åŠ ãƒ»ä¿®æ­£
const [criteria, setCriteria] = useState<PasswordCriteria>({
  length: 12,
  count: 50, // 3ã‹ã‚‰50ã«å¤‰æ›´
  includeUppercase: true,
  includeLowercase: true,
  includeNumbers: true,
  includeSymbols: false,
  excludeAmbiguous: true,
  customCharacters: ''
});

// æ–°ã—ã„stateã‚’è¿½åŠ 
const [composition, setComposition] = useState<string>('none');
const [customSymbols, setCustomSymbols] = useState<string>('');
const [customCharsets, setCustomCharsets] = useState<CustomCharsetRequirement[]>([]);

// APIå‘¼ã³å‡ºã—é–¢æ•°ã‚’ä¿®æ­£
const generatePasswords = async () => {
  setIsGenerating(true);
  setApiError(null);
  
  // TDã®åå¿œ
  setTdState(prev => ({
    ...prev,
    emotion: 'thinking',
    animation: 'wiggle',
    message: 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ç”Ÿæˆä¸­ã§ã™... ã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„â™ª',
    showSpeechBubble: true
  }));

  try {
    // æ§‹æˆãƒ—ãƒªã‚»ãƒƒãƒˆå¯¾å¿œã®APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ä½¿ç”¨
    const endpoint = composition !== 'none' 
      ? 'http://localhost:3001/api/password/generate-with-composition'
      : 'http://localhost:3001/api/password/generate';
    
    const requestBody = composition !== 'none' 
      ? {
          length: criteria.length,
          count: criteria.count,
          composition,
          customSymbols: composition === 'custom-symbols' ? customSymbols : undefined,
          customCharsets: composition === 'custom-charsets' ? customCharsets : undefined,
          excludeSimilar: criteria.excludeAmbiguous,
          useNumbers: criteria.includeNumbers,
          useUppercase: criteria.includeUppercase,
          useLowercase: criteria.includeLowercase,
          useSymbols: criteria.includeSymbols
        }
      : criteria;

    const response = await fetch(endpoint, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-Session-ID': `td-session-${Date.now()}`,
      },
      body: JSON.stringify(requestBody)
    });

    if (!response.ok) {
      const errorData = await response.json();
      throw new Error(errorData.error?.message || `HTTP ${response.status}`);
    }

    const data = await response.json();
    setResult(data.data);

    // TDã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®æˆåŠŸåå¿œ
    setTdState(prev => ({
      ...prev,
      emotion: 'excited',
      animation: 'heartbeat',
      message: data.tdMessage || `${data.data.strength}å¼·åº¦ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’${data.data.passwords.length}å€‹ç”Ÿæˆã—ã¾ã—ãŸï¼`,
      showSpeechBubble: true
    }));

    setTimeout(() => {
      setTdState(prev => ({ ...prev, showSpeechBubble: false }));
    }, 3000);

  } catch (error) {
    console.error('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error);
    setApiError(error instanceof Error ? error.message : 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
    
    setTdState(prev => ({
      ...prev,
      emotion: 'sad',
      animation: 'wiggle',
      message: 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ... è¨­å®šã‚’ç¢ºèªã—ã¦å†åº¦ãŠè©¦ã—ãã ã•ã„',
      showSpeechBubble: true
    }));
  } finally {
    setIsGenerating(false);
  }
};

// JSXã®æ§‹æˆé¸æŠéƒ¨åˆ†ã‚’è¿½åŠ ï¼ˆè¨­å®šãƒ•ã‚©ãƒ¼ãƒ ã®æœ€ä¸Šéƒ¨ã«ï¼‰
<CompositionSelector 
  value={composition}
  onChange={setComposition}
/>

<CustomSymbolsInput 
  value={customSymbols}
  onChange={setCustomSymbols}
  visible={composition === 'custom-symbols'}
/>

<CustomCharsetsEditor 
  charsets={customCharsets}
  onChange={setCustomCharsets}
  visible={composition === 'custom-charsets'}
/>
```

---

### Phase 4: çµ±åˆãƒ»ãƒ†ã‚¹ãƒˆ

#### 4.1 å‹•ä½œç¢ºèªæ‰‹é †

1. **é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•**
```bash
# ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
cd td-buddy-webapp/backend
npm run dev

# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆåˆ¥ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ï¼‰
cd td-buddy-webapp/frontend
npm run dev
```

2. **åŸºæœ¬å‹•ä½œç¢ºèª**
- [ ] http://localhost:3000/password ã«ã‚¢ã‚¯ã‚»ã‚¹
- [ ] æ§‹æˆãƒ—ãƒªã‚»ãƒƒãƒˆé¸æŠæ¬„ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] å„ãƒ—ãƒªã‚»ãƒƒãƒˆã‚’é¸æŠã—ã¦å‹•ä½œç¢ºèª
- [ ] ç”Ÿæˆå€‹æ•°ãŒ50å€‹ã«å¤‰æ›´ã•ã‚Œã¦ã„ã‚‹

3. **ãƒ—ãƒªã‚»ãƒƒãƒˆåˆ¥ãƒ†ã‚¹ãƒˆ**
- [ ] ã€ŒæŒ‡å®šãªã—ã€: å¾“æ¥é€šã‚Šã®å‹•ä½œ
- [ ] ã€Œæ•°å­—ãƒ»å¤§æ–‡å­—ãƒ»å°æ–‡å­—ã‚’å¿…ãšå«ã‚€ã€: å„æ–‡å­—ç¨®ãŒå«ã¾ã‚Œã‚‹
- [ ] ã€Œæ•°å­—ãƒ»å¤§æ–‡å­—ãƒ»å°æ–‡å­—ãƒ»è¨˜å·æ–‡å­—ã‚’å¿…ãšå«ã‚€ã€: è¨˜å·ã‚‚å«ã¾ã‚Œã‚‹
- [ ] ã€Œã‚«ã‚¹ã‚¿ãƒ è¨˜å·ã€: å…¥åŠ›æ¬„ãŒè¡¨ç¤ºã•ã‚Œã€æŒ‡å®šè¨˜å·ãŒå«ã¾ã‚Œã‚‹
- [ ] ã€Œã‚«ã‚¹ã‚¿ãƒ æ–‡å­—ç¨®ã€: æ–‡å­—ç¨®è¨­å®šã‚¨ãƒªã‚¢ãŒè¡¨ç¤ºã•ã‚Œã‚‹

4. **ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ç¢ºèª**
- [ ] æ–‡å­—æ•° < å¿…è¦æ–‡å­—ç¨®æ•°ã®å ´åˆã®ã‚¨ãƒ©ãƒ¼
- [ ] ç©ºã®æ–‡å­—ã‚»ãƒƒãƒˆæŒ‡å®šæ™‚ã®ã‚¨ãƒ©ãƒ¼
- [ ] ä¸æ­£ãªæ–‡å­—æ•°ãƒ»å€‹æ•°æŒ‡å®šæ™‚ã®ã‚¨ãƒ©ãƒ¼

5. **TDã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç¢ºèª**
- [ ] ç”Ÿæˆé–‹å§‹æ™‚ã®åå¿œ
- [ ] æˆåŠŸæ™‚ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- [ ] ã‚¨ãƒ©ãƒ¼æ™‚ã®ã‚µãƒãƒ¼ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

#### 4.2 ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä¾‹

```typescript
// ãƒ†ã‚¹ãƒˆä¾‹ï¼šå¿…é ˆæ–‡å­—ç¨®ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
const testCompositionRequirements = (passwords: string[], composition: string) => {
  switch (composition) {
    case 'num-upper-lower':
      passwords.forEach(password => {
        expect(password).toMatch(/[0-9]/); // æ•°å­—
        expect(password).toMatch(/[A-Z]/); // å¤§æ–‡å­—
        expect(password).toMatch(/[a-z]/); // å°æ–‡å­—
      });
      break;
    
    case 'num-upper-lower-symbol':
      passwords.forEach(password => {
        expect(password).toMatch(/[0-9]/);
        expect(password).toMatch(/[A-Z]/);
        expect(password).toMatch(/[a-z]/);
        expect(password).toMatch(/[!@#$%^&*()]/); // è¨˜å·
      });
      break;
  }
};
```

---

## ğŸ› ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ–¹æ³•

#### 1. APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒè¦‹ã¤ã‹ã‚‰ãªã„
**ç—‡çŠ¶**: 404 Not Found ã‚¨ãƒ©ãƒ¼
**è§£æ±º**: 
- ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèª
- ãƒ«ãƒ¼ãƒˆãŒæ­£ã—ãè¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
- CORSã®è¨­å®šã‚’ç¢ºèª

#### 2. æ§‹æˆãƒ—ãƒªã‚»ãƒƒãƒˆãŒå‹•ä½œã—ãªã„
**ç—‡çŠ¶**: å¿…é ˆæ–‡å­—ç¨®ãŒå«ã¾ã‚Œã¦ã„ãªã„
**è§£æ±º**:
- CompositionPasswordServiceã®å®Ÿè£…ã‚’ç¢ºèª
- è¦ä»¶å®šç¾©ãŒæ­£ã—ã„ã‹ç¢ºèª
- ã‚·ãƒ£ãƒƒãƒ•ãƒ«å‡¦ç†ãŒæ­£ã—ãå‹•ä½œã—ã¦ã„ã‚‹ã‹ç¢ºèª

#### 3. ã‚«ã‚¹ã‚¿ãƒ æ–‡å­—ç¨®ãŒä¿å­˜ã•ã‚Œãªã„
**ç—‡çŠ¶**: è¨­å®šã—ãŸæ–‡å­—ç¨®ãŒç„¡è¦–ã•ã‚Œã‚‹
**è§£æ±º**:
- ã‚«ã‚¹ã‚¿ãƒ æ–‡å­—ç¨®ã®enabledçŠ¶æ…‹ã‚’ç¢ºèª
- ç©ºã®æ–‡å­—ã‚»ãƒƒãƒˆãŒå«ã¾ã‚Œã¦ã„ãªã„ã‹ç¢ºèª
- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å‡¦ç†ã‚’ç¢ºèª

#### 4. TDã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãŒåå¿œã—ãªã„
**ç—‡çŠ¶**: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œãªã„
**è§£æ±º**:
- tdStateã®æ›´æ–°å‡¦ç†ã‚’ç¢ºèª
- showSpeechBubbleã®å€¤ã‚’ç¢ºèª
- ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå‡¦ç†ã‚’ç¢ºèª

---

## ğŸ“ˆ å®Ÿè£…å¾Œã®æ‹¡å¼µæ¡ˆ

### çŸ­æœŸæ‹¡å¼µï¼ˆ1é€±é–“ä»¥å†…ï¼‰
- [ ] ãƒ—ãƒªã‚»ãƒƒãƒˆä¿å­˜æ©Ÿèƒ½ï¼ˆLocalStorageï¼‰
- [ ] ã‚ˆãä½¿ã†è¨­å®šã®å±¥æ­´æ©Ÿèƒ½
- [ ] ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¼·åº¦ã®è©³ç´°è¡¨ç¤º

### ä¸­æœŸæ‹¡å¼µï¼ˆ1ãƒ¶æœˆä»¥å†…ï¼‰
- [ ] ç”Ÿæˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®æœ€é©åŒ–
- [ ] ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½ï¼ˆCSVã€JSONï¼‰
- [ ] çµ±è¨ˆæƒ…å ±ã®è¡¨ç¤º

### é•·æœŸæ‹¡å¼µï¼ˆå°†æ¥ï¼‰
- [ ] Claude AIé€£æºã«ã‚ˆã‚‹è‡ªç„¶è¨€èªè¨­å®š
- [ ] è¤‡é›‘ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒªã‚·ãƒ¼å¯¾å¿œ
- [ ] çµ„ç¹”å‘ã‘ãƒ—ãƒªã‚»ãƒƒãƒˆç®¡ç†

---

**ğŸ¤– TDã‹ã‚‰ã®æ¿€åŠ±ï¼š**
*ã€Œå®Ÿè£…ã‚¬ã‚¤ãƒ‰ã®æº–å‚™å®Œäº†ã§ã™ï¼æ®µéšçš„ã«é€²ã‚ã‚Œã°å¿…ãšå®Œæˆã§ãã¾ã™ã€‚å›°ã£ãŸã¨ãã¯ã“ã®ã‚¬ã‚¤ãƒ‰ã‚’è¦‹è¿”ã—ã¦ã€ä¸€æ­©ãšã¤ç¢ºå®Ÿã«é€²ã‚ã¦ã„ãã¾ã—ã‚‡ã†ã€‚TDã‚‚ä¸€ç·’ã«å¿œæ´ã—ã¦ã„ã¾ã™â™ªã€* 