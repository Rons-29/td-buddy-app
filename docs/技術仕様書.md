# TestData Buddy - æŠ€è¡“ä»•æ§˜æ›¸

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

### ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ
```mermaid
graph TB
    User[QAã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢] --> Cursor[Cursor IDE]
    User --> WebUI[Remix Web UI]
    
    Cursor --> MCP[MCP Protocol Handler]
    WebUI --> API[REST API Gateway]
    
    MCP --> Claude[Claude API]
    Claude --> MCP
    
    MCP --> Core[Data Generation Core]
    API --> Core
    
    Core --> DB[(SQLite Database)]
    Core --> FileSystem[Local File System]
    
    subgraph "NestJS Backend"
        MCP
        API
        Core
    end
```

## ğŸ“¡ APIä»•æ§˜

### 1. ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç”ŸæˆAPI

#### `POST /api/generate/password`
```typescript
interface PasswordRequest {
  length: number;           // 8-128
  includeUpper: boolean;    // A-Z
  includeLower: boolean;    // a-z
  includeNumbers: boolean;  // 0-9
  includeSymbols: boolean;  // !@#$%^&*
  count?: number;          // ç”Ÿæˆæ•° (default: 1)
  excludeAmbiguous?: boolean; // ç´›ã‚‰ã‚ã—ã„æ–‡å­—é™¤å¤–
}

interface PasswordResponse {
  passwords: string[];
  strength: {
    score: number;      // 0-4
    feedback: string[];
  };
  metadata: {
    generatedAt: string;
    totalCount: number;
  };
}
```

### 2. ãƒ•ã‚¡ã‚¤ãƒ«ç”ŸæˆAPI

#### `POST /api/generate/file`
```typescript
interface FileGenerationRequest {
  format: 'csv' | 'json' | 'xml' | 'txt' | 'pdf' | 'image';
  size?: {
    bytes?: number;     // ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºæŒ‡å®š
    rows?: number;      // ãƒ¬ã‚³ãƒ¼ãƒ‰æ•°æŒ‡å®š
  };
  schema?: FieldSchema[];
  options?: FileOptions;
}

interface FieldSchema {
  name: string;
  type: 'string' | 'number' | 'boolean' | 'date' | 'uuid' | 'email' | 'phone' | 'address';
  constraints?: {
    min?: number;
    max?: number;
    pattern?: string;
    enum?: string[];
  };
}

interface FileGenerationResponse {
  fileId: string;
  downloadUrl: string;
  metadata: {
    filename: string;
    size: number;
    recordCount?: number;
    generatedAt: string;
  };
}
```

### 3. å€‹äººæƒ…å ±ç”ŸæˆAPI

#### `POST /api/generate/personal-info`
```typescript
interface PersonalInfoRequest {
  count: number;        // ç”Ÿæˆä»¶æ•°
  locale: 'ja' | 'en'; // ãƒ­ã‚±ãƒ¼ãƒ«
  fields: PersonalField[];
  format: 'array' | 'csv' | 'json';
}

type PersonalField = 
  | 'fullName' | 'firstName' | 'lastName'
  | 'email' | 'phone' | 'address' | 'zipCode'
  | 'birthDate' | 'age' | 'gender'
  | 'company' | 'jobTitle';

interface PersonalInfoResponse {
  data: PersonalInfo[] | string; // array ã¾ãŸã¯ CSV/JSONæ–‡å­—åˆ—
  metadata: {
    count: number;
    fields: PersonalField[];
    generatedAt: string;
  };
}
```

### 4. MCP Protocol API

#### `POST /api/mcp/execute`
```typescript
interface MCPRequest {
  action: string;       // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å
  parameters: any;      // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å›ºæœ‰ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
  context?: {
    user?: string;
    session?: string;
  };
}

interface MCPResponse {
  success: boolean;
  data?: any;
  error?: {
    code: string;
    message: string;
    details?: any;
  };
  metadata: {
    executedAt: string;
    duration: number;
  };
}
```

## ğŸ”§ æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯è©³ç´°

### Backend (NestJS)

#### ä¾å­˜é–¢ä¿‚
```json
{
  "dependencies": {
    "@nestjs/core": "^10.0.0",
    "@nestjs/common": "^10.0.0",
    "@nestjs/platform-express": "^10.0.0",
    "@nestjs/swagger": "^7.0.0",
    "@nestjs/typeorm": "^10.0.0",
    "typeorm": "^0.3.0",
    "sqlite3": "^5.1.0",
    "faker": "^6.6.6",
    "@faker-js/faker": "^8.0.0",
    "sharp": "^0.32.0",
    "pdfkit": "^0.13.0",
    "csv-stringify": "^6.4.0",
    "xml2js": "^0.6.0",
    "zxcvbn": "^4.4.2",
    "uuid": "^9.0.0",
    "date-fns": "^2.30.0",
    "class-validator": "^0.14.0",
    "class-transformer": "^0.5.0"
  }
}
```

#### ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ§‹æˆ
```typescript
// src/app.module.ts
@Module({
  imports: [
    TypeOrmModule.forRoot({
      type: 'sqlite',
      database: 'data/database.sqlite',
      autoLoadEntities: true,
      synchronize: true,
    }),
    PasswordModule,
    FileGenerationModule,
    PersonalInfoModule,
    MCPModule,
    ClaudeIntegrationModule,
  ],
})
export class AppModule {}
```

### Frontend (Remix)

#### ä¾å­˜é–¢ä¿‚
```json
{
  "dependencies": {
    "@remix-run/node": "^2.0.0",
    "@remix-run/react": "^2.0.0",
    "@remix-run/serve": "^2.0.0",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "@headlessui/react": "^1.7.0",
    "@heroicons/react": "^2.0.0",
    "tailwindcss": "^3.3.0",
    "zxcvbn": "^4.4.2",
    "react-hot-toast": "^2.4.0"
  }
}
```

#### ãƒšãƒ¼ã‚¸æ§‹æˆ
```
app/routes/
â”œâ”€â”€ _index.tsx              # ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
â”œâ”€â”€ password.tsx            # ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç”Ÿæˆ
â”œâ”€â”€ file-generation.tsx     # ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ
â”œâ”€â”€ personal-info.tsx       # å€‹äººæƒ…å ±ç”Ÿæˆ
â”œâ”€â”€ text-generation.tsx     # ãƒ†ã‚­ã‚¹ãƒˆç”Ÿæˆ
â””â”€â”€ settings.tsx           # è¨­å®š
```

## ğŸ“Š ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

### Entityå®šç¾©

```typescript
// Generation History
@Entity()
export class GenerationHistory {
  @PrimaryGeneratedColumn()
  id: number;

  @Column()
  type: string; // 'password', 'file', 'personal_info', etc.

  @Column('text')
  parameters: string; // JSONæ–‡å­—åˆ—

  @Column('text', { nullable: true })
  result: string; // ç”Ÿæˆçµæœã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿

  @CreateDateColumn()
  createdAt: Date;

  @Column({ nullable: true })
  userId?: string;
}

// File Templates
@Entity()
export class FileTemplate {
  @PrimaryGeneratedColumn()
  id: number;

  @Column()
  name: string;

  @Column()
  type: string;

  @Column('text')
  schema: string; // JSONæ–‡å­—åˆ—

  @CreateDateColumn()
  createdAt: Date;

  @UpdateDateColumn()
  updatedAt: Date;
}

// User Settings
@Entity()
export class UserSettings {
  @PrimaryGeneratedColumn()
  id: number;

  @Column({ unique: true })
  userId: string;

  @Column('text')
  preferences: string; // JSONæ–‡å­—åˆ—

  @UpdateDateColumn()
  updatedAt: Date;
}
```

## ğŸ¤– Claude API é€£æº

### ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­è¨ˆ

#### ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
```typescript
const SYSTEM_PROMPT = `
ã‚ãªãŸã¯TestData Buddyã®AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚
QAã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç”Ÿæˆè¦æ±‚ã‚’ç†è§£ã—ã€é©åˆ‡ãªAPIãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚

åˆ©ç”¨å¯èƒ½ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³:
1. generatePassword - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç”Ÿæˆ
2. generateFile - ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ
3. generatePersonalInfo - å€‹äººæƒ…å ±ç”Ÿæˆ
4. generateText - ãƒ†ã‚­ã‚¹ãƒˆç”Ÿæˆ

ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¯å¿…ãšJSONå½¢å¼ã§ã€ä»¥ä¸‹ã®æ§‹é€ ã«å¾“ã£ã¦ãã ã•ã„:
{
  "action": "ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å",
  "parameters": { /* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å›ºæœ‰ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ */ },
  "reasoning": "ãªãœã“ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’é¸æŠã—ãŸã‹ã®èª¬æ˜"
}
`;
```

#### ä¾‹: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
```typescript
const generatePasswordPrompt = (userInput: string) => `
ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¦æ±‚: "${userInput}"

ã“ã®è¦æ±‚ã‚’ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç”ŸæˆAPIã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«å¤‰æ›ã—ã¦ãã ã•ã„ã€‚
è€ƒæ…®äº‹é …:
- æ–‡å­—æ•°ã®æŒ‡å®š
- ä½¿ç”¨ã™ã‚‹æ–‡å­—ç¨®
- ç”Ÿæˆæ•°
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶

JSONå½¢å¼ã§å›ç­”ã—ã¦ãã ã•ã„ã€‚
`;
```

## ğŸ›¡ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä»•æ§˜

### APIèªè¨¼ãƒ»èªå¯
```typescript
// JWTèªè¨¼ï¼ˆå°†æ¥å®Ÿè£…äºˆå®šï¼‰
@Injectable()
export class AuthGuard implements CanActivate {
  canActivate(context: ExecutionContext): boolean {
    // ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ã¯èªè¨¼ã‚’ã‚¹ã‚­ãƒƒãƒ—
    return process.env.NODE_ENV === 'development' || this.validateToken(context);
  }
}
```

### ãƒ‡ãƒ¼ã‚¿ä¿è­·
- ç”Ÿæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã¯24æ™‚é–“å¾Œã«è‡ªå‹•å‰Šé™¤
- å€‹äººæƒ…å ±ã¯å®Ÿåœ¨ã—ãªã„æ“¬ä¼¼ãƒ‡ãƒ¼ã‚¿ã®ã¿
- Claude APIã¸ã®é€ä¿¡ãƒ‡ãƒ¼ã‚¿ã«ã¯ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼æƒ…å ±ã‚’å«ã‚ãªã„

### å…¥åŠ›æ¤œè¨¼
```typescript
// ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç”Ÿæˆãƒªã‚¯ã‚¨ã‚¹ãƒˆã®æ¤œè¨¼
export class PasswordRequestDto {
  @IsInt()
  @Min(4)
  @Max(128)
  length: number;

  @IsBoolean()
  includeUpper: boolean;

  @IsBoolean()
  includeLower: boolean;

  @IsBoolean()
  includeNumbers: boolean;

  @IsBoolean()
  includeSymbols: boolean;

  @IsOptional()
  @IsInt()
  @Min(1)
  @Max(100)
  count?: number;
}
```

## ğŸ”„ ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹çµ±ä¸€ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
```typescript
interface ErrorResponse {
  statusCode: number;
  message: string;
  errorCode: string;
  timestamp: string;
  path: string;
  details?: any;
}

// ä¾‹
{
  "statusCode": 400,
  "message": "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰é•·ã¯8æ–‡å­—ä»¥ä¸Šã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™",
  "errorCode": "E_INVALID_PASSWORD_LENGTH",
  "timestamp": "2024-01-15T10:30:00Z",
  "path": "/api/generate/password",
  "details": {
    "minLength": 8,
    "providedLength": 4
  }
}
```

### ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰å®šç¾©
- `E_INVALID_INPUT` - å…¥åŠ›å€¤ãŒç„¡åŠ¹
- `E_GENERATION_FAILED` - ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆã«å¤±æ•—
- `E_FILE_TOO_LARGE` - ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãŒä¸Šé™ã‚’è¶…é
- `E_CLAUDE_API_ERROR` - Claude APIå‘¼ã³å‡ºã—ã‚¨ãƒ©ãƒ¼
- `E_DATABASE_ERROR` - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼

## ğŸ“ˆ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ä»•æ§˜

### ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“ç›®æ¨™
- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç”Ÿæˆ: < 100ms
- å°ã‚µã‚¤ã‚ºãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ (< 1MB): < 1ç§’
- å¤§ã‚µã‚¤ã‚ºãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ (< 100MB): < 30ç§’
- å€‹äººæƒ…å ±ç”Ÿæˆ (< 1000ä»¶): < 2ç§’

### ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡åˆ¶é™
- å¤§å®¹é‡ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆæ™‚ã¯ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å‡¦ç†ã‚’ä½¿ç”¨
- æœ€å¤§ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡: 512MB

### åŒæ™‚å®Ÿè¡Œåˆ¶é™
```typescript
@Injectable()
export class RateLimitGuard implements CanActivate {
  private readonly requests = new Map<string, number[]>();
  
  canActivate(context: ExecutionContext): boolean {
    const request = context.switchToHttp().getRequest();
    const ip = request.ip;
    
    // IPåˆ¥ã®åŒæ™‚å®Ÿè¡Œæ•°åˆ¶é™: 5ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/åˆ†
    return this.checkRateLimit(ip, 5, 60000);
  }
}
```

## ğŸ§ª ãƒ†ã‚¹ãƒˆä»•æ§˜

### ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
```typescript
describe('PasswordService', () => {
  it('æŒ‡å®šã•ã‚ŒãŸæ¡ä»¶ã§ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã™ã‚‹', () => {
    const service = new PasswordService();
    const result = service.generate({
      length: 12,
      includeUpper: true,
      includeLower: true,
      includeNumbers: true,
      includeSymbols: false,
    });
    
    expect(result).toHaveLength(12);
    expect(result).toMatch(/^[A-Za-z0-9]+$/);
  });
});
```

### E2Eãƒ†ã‚¹ãƒˆ
```typescript
describe('Password Generation API', () => {
  it('POST /api/generate/password', () => {
    return request(app.getHttpServer())
      .post('/api/generate/password')
      .send({
        length: 16,
        includeUpper: true,
        includeLower: true,
        includeNumbers: true,
        includeSymbols: true,
      })
      .expect(201)
      .expect((res) => {
        expect(res.body.passwords).toHaveLength(1);
        expect(res.body.passwords[0]).toHaveLength(16);
      });
  });
});
``` 